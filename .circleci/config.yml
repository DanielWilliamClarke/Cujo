version: 2
jobs:
  client:
    dependencies:
      cache_directories:
        - "~/.google-chrome"
      pre:
        - ${HOME}/${CIRCLE_PROJECT_REPONAME}/get-chrome.sh .google-chrome
    docker:
      - image: circleci/node:10
    steps:
      - checkout
      - run:
          name: Setup Environment
          command: cd ./client && sudo npm run setup
      - run:
          name: Run Tests
          command: cd ./client && sudo npm run test
      - run:
          name: Run Coverage
          command: cd ./client && sudo npm run coverage

  server:
    working_directory: ~/server
    docker:
      - image: circleci/node:10
    steps:
      - checkout

workflows:
  version: 2
  build_test_client_server:
    jobs:
      - client
      - server