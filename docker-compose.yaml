version: "3.6"

services:

  proxy:
    image: jwilder/nginx-proxy
    container_name: nginx-proxy
    ports:
      - '80:80'
      - '443:443'
    volumes:
      - /var/run/docker.sock:/tmp/docker.sock:ro
      - /etc/nginx/vhost.d
      - /usr/share/nginx/html
      - ./docker/certs:/etc/nginx/certs:ro

  ssl-companion:
    image: jrcs/letsencrypt-nginx-proxy-companion
    container_name: ssl-companion
    volumes:
      - ./docker/certs:/etc/nginx/certs:rw
      - /var/run/docker.sock:/var/run/docker.sock:ro
    volumes_from:
      - proxy
    depends_on:
      - proxy

  portfolio:
    # build: 
    #   context: ./portfolio
    image: dclarkious/cujo-portfolio:latest
    environment:
      - WORDPRESS_HOST=https://blog.${DOMAIN}
      - VIRTUAL_HOST=${DOMAIN}
      - VIRTUAL_PORT=5000
    # volumes:
    #   - ./portfolio/build:/usr/share/nginx/html
    #   - ./portfolio/env.sh:/usr/share/nginx/html/env.sh
    #   - ./portfolio/app.env:/usr/share/nginx/html/app.env
    networks:
      - wordpress

  # wordpress:
  #   depends_on:
  #     - db
  #   image: wordpress:latest
  #   restart: always
  #   expose: 
  #   - "80"
  #   environment:
  #     - WORDPRESS_DB_HOST=db:3306
  #     - WORDPRESS_DB_NAME=${WORDPRESS_DB_NAME}
  #     - WORDPRESS_DB_USER=${WORDPRESS_USER_NAME}
  #     - WORDPRESS_DB_PASSWORD=${WORDPRESS_DB_PASSWORD}
  #     - VIRTUAL_HOST=blog.${DOMAIN}
  #     - VIRTUAL_PORT=80
  #     - LETSENCRYPT_HOST=blog.${DOMAIN}
  #     - LETSENCRYPT_EMAIL=dc@${DOMAIN}
  #   networks:
  #     - wordpress

  # db:
  #   image: mysql:5.7
  #   volumes:
  #     - db_data:/var/lib/mysql
  #   restart: always
  #   environment:
  #     MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
  #     MYSQL_DATABASE: ${WORDPRESS_DB_NAME}
  #     MYSQL_USER: ${WORDPRESS_USER_NAME}
  #     MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
  #   networks:
  #     - wordpress

volumes:
  db_data: {}

networks:
  wordpress:
